#!/usr/bin/env bash
# Injects /prompts:checkpoint into the CX pane with NO arguments.
set -euo pipefail
STATE_DIR="${RELAY_STATE_DIR:?RELAY_STATE_DIR not set â€” must be exported by bin/party}"
PANES_FILE="$STATE_DIR/panes.json"
CHK_ID_FILE="$STATE_DIR/cx-chk-id"
CX_PANE=$(jq -r '.panes.cx // empty' "$PANES_FILE")
if [[ -z "$CX_PANE" ]]; then
    echo "ERROR: CX pane not registered in $PANES_FILE" >&2
    exit 1
fi
if [[ ! -s "$CHK_ID_FILE" ]]; then
    echo "WARN: checkpoint id handoff file missing at $CHK_ID_FILE" >&2
fi
tmux-inject "$CX_PANE" "/prompts:checkpoint"
