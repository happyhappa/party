#!/usr/bin/env bash
# Injects /prompts:checkpoint into the CX pane.
# Optional arg: CHK_ID to write as handoff file for CX prompt template.
set -euo pipefail
PANES_FILE="${RELAY_STATE_DIR:-$HOME/llm-share/relay/state}/panes.json"
CX_PANE=$(jq -r '.panes.cx // empty' "$PANES_FILE")
if [[ -z "$CX_PANE" ]]; then
    echo "ERROR: CX pane not registered in $PANES_FILE" >&2
    exit 1
fi
# Write CHK_ID handoff file for CX prompt template
if [[ -n "${1:-}" ]]; then
    echo "$1" > /tmp/cx-chk-id
fi
tmux-inject "$CX_PANE" "/prompts:checkpoint"
